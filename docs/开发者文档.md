# AICowork 开发者文档

> 版本：0.1.0
> 最后更新：2026-01-23

---

## 目录

1. [项目概述](#项目概述)
2. [技术架构](#技术架构)
3. [开发环境搭建](#开发环境搭建)
4. [项目结构](#项目结构)
5. [核心模块说明](#核心模块说明)
6. [API 参考](#api-参考)
7. [插件开发指南](#插件开发指南)
8. [测试指南](#测试指南)
9. [打包发布](#打包发布)
10. [贡献指南](#贡献指南)

---

## 项目概述

### 技术栈

- **前端**: React 19 + TypeScript + Vite + TailwindCSS 4
- **桌面框架**: Electron 39
- **状态管理**: Zustand 5
- **国际化**: i18next
- **数据库**: better-sqlite3 + Memvid SDK
- **AI SDK**: @anthropic-ai/claude-agent-sdk 0.2.6
- **构建工具**: electron-builder 26
- **测试框架**: Vitest
- **日志系统**: Winston 3

### 核心特性

- 多 AI 服务商支持（60+ 厂商）
- 本地记忆系统（双后端：Memvid + 文件系统）
- MCP (Model Context Protocol) 服务器集成
- 技能扩展系统
- 代理编排系统
- 钩子机制
- 权限控制
- 多语言支持（10+ 语言）

---

## 技术架构

### 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                     Electron 主进程                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │  API 代理层  │  │  会话管理    │  │  存储层      │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────┬───────────────────────────────────┘
                      │ IPC 通信
┌─────────────────────┴───────────────────────────────────┐
│                   React 渲染进程                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │  UI 组件     │  │  状态管理    │  │  业务逻辑    │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
```

### 进程通信

- **IPC Main**: Electron 主进程事件处理器
- **IPC Renderer**: 渲染进程调用主进程 API
- **preload**: 安全的上下文隔离桥接

---

## 开发环境搭建

### 前置要求

- **Node.js**: >= 18.0.0
- **pnpm**: >= 8.0.0（推荐）或 npm >= 9.0.0
- **Git**: >= 2.0.0

### 安装步骤

#### 1. 克隆项目

```bash
git clone https://github.com/Pan519/AICowork.git
cd AICowork
```

#### 2. 安装依赖

```bash
# 使用 pnpm（推荐）
pnpm install

# 或使用 npm
npm install

# 重建 native 模块
pnpm rebuild
```

#### 3. 配置环境变量（可选）

创建 `.env` 文件在项目根目录：

```env
# 开发服务器端口
PORT=5173

# API 配置（用于测试）
ANTHROPIC_API_KEY=sk-your-api-key
ANTHROPIC_BASE_URL=https://api.anthropic.com
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
```

#### 4. 启动开发服务器

```bash
# 启动完整开发环境（Electron + Vite）
pnpm dev

# 或分别启动
pnpm dev:react    # 启动 React 开发服务器
pnpm dev:electron # 启动 Electron
```

#### 5. 开发工具

- **React DevTools**: 在 Electron 中按 `F12` 打开
- **日志位置**:
  - Windows: `%APPDATA%\AICowork\logs\`
  - macOS: `~/Library/Application Support/AICowork/logs/`
  - Linux: `~/.config/AICowork/logs/`

---

## 项目结构

```
AICowork/
├── src/
│   ├── electron/              # Electron 主进程代码
│   │   ├── libs/              # 核心库模块
│   │   │   ├── config-store.ts      # API 配置管理
│   │   │   ├── session-store.ts     # 会话存储
│   │   │   ├── memory-tools.ts      # 记忆系统
│   │   │   ├── memvid-store.ts      # Memvid 数据库
│   │   │   ├── fs-memory-store.ts   # 文件系统存储
│   │   │   ├── skills-store.ts      # 技能管理
│   │   │   ├── agents-store.ts      # 代理管理
│   │   │   ├── mcp-store.ts         # MCP 服务器管理
│   │   │   ├── hooks-store.ts       # 钩子管理
│   │   │   ├── permissions-store.ts # 权限管理
│   │   │   ├── output-store.ts      # 输出配置
│   │   │   └── rules-store.ts       # 规则管理
│   │   ├── api-proxy/         # API 代理层
│   │   │   ├── index.ts             # 代理主入口
│   │   │   ├── server.ts            # SSE 服务器
│   │   │   └── token-counter.ts     # Token 计数
│   │   ├── handlers/          # 会话处理器
│   │   ├── utils/            # 工具函数
│   │   ├── config/           # 配置常量
│   │   ├── main.ts           # 主进程入口
│   │   ├── ipc-handlers.ts   # IPC 事件处理
│   │   ├── logger.ts         # 日志系统
│   │   ├── error-handling.ts # 错误处理
│   │   └── types.ts          # 类型定义
│   ├── ui/                   # React 前端代码
│   │   ├── components/       # UI 组件
│   │   ├── pages/            # 页面组件
│   │   │   └── SettingsPage/ # 设置页面
│   │   ├── hooks/            # React Hooks
│   │   ├── store/            # Zustand 状态管理
│   │   ├── i18n/             # 国际化
│   │   │   └── locales/      # 语言文件
│   │   ├── utils/            # 工具函数
│   │   ├── types.ts          # 类型定义
│   │   └── main.tsx          # React 入口
│   └── shared/               # 共享代码
├── dist-electron/            # Electron 编译输出
├── dist-react/               # React 构建输出
├── templateIcon.ico          # 应用图标
├── electron-builder.json     # 打包配置
├── vite.config.ts            # Vite 配置
├── tsconfig.json             # TypeScript 配置
├── package.json              # 项目配置
└── README.md                 # 项目说明
```

---

## 核心模块说明

### 1. API 配置管理 (config-store.ts)

#### 数据结构

```typescript
interface ApiConfig {
  id: string;                    // 唯一 ID
  name: string;                  // 配置名称
  apiKey: string;                // API 密钥
  baseURL: string;               // API 基础 URL
  model: string;                 // 模型名称
  apiType: ApiProvider;          // 厂商类型
  isActive?: boolean;            // 是否激活
  customHeaders?: Record<string, string>; // 自定义请求头
  createdAt?: number;            // 创建时间戳
  updatedAt?: number;            // 更新时间戳
}

interface ApiConfigsStore {
  activeConfigId?: string;
  configs: ApiConfig[];
}
```

#### 主要方法

```typescript
// 加载所有配置
function loadAllApiConfigs(): ApiConfigsStore;

// 保存配置
function saveApiConfig(config: ApiConfig): void;

// 异步保存配置
function saveApiConfigAsync(config: ApiConfig): Promise<Result>;

// 删除配置
function deleteApiConfig(configId: string): void;

// 设置激活配置
function setActiveApiConfig(configId: string): void;

// 验证配置
function validateApiConfig(config: ApiConfig): ValidationResult;

// 获取厂商默认配置
function getProviderDefaults(provider: ApiProvider): Partial<ApiConfig>;
```

#### 使用示例

```typescript
import { loadAllApiConfigs, saveApiConfig } from './libs/config-store.js';

// 加载配置
const { configs, activeConfigId } = loadAllApiConfigs();

// 保存新配置
const newConfig = {
  id: `cfg_${Date.now()}`,
  name: '智谱 AI',
  apiKey: 'sk-xxx',
  baseURL: 'https://open.bigmodel.cn/api/paas/v4',
  model: 'glm-4',
  apiType: 'bigmodel'
};

saveApiConfig(newConfig);
```

### 2. 会话管理 (session-store.ts)

#### 数据结构

```typescript
interface Session {
  id: string;
  title: string;
  cwd?: string;
  status: 'idle' | 'running';
  createdAt: number;
  updatedAt: number;
  messageCount: number;
}

interface Message {
  role: 'user' | 'assistant';
  content: string;
  timestamp: number;
}
```

#### 主要方法

```typescript
// 创建会话
function createSession(id: string, cwd?: string): Session;

// 获取会话
function getSession(id: string): Session | null;

// 列出所有会话
function listSessions(): Session[];

// 删除会话
function deleteSession(id: string): boolean;

// 重命名会话
function renameSession(id: string, newTitle: string): boolean;

// 添加消息
function addMessage(sessionId: string, role: string, content: string): void;

// 获取会话历史
function getSessionHistory(sessionId: string): { session: Session; messages: Message[] } | null;
```

### 3. 记忆系统 (memory-tools.ts)

#### 数据结构

```typescript
interface MemoryDocument {
  title: string;           // 记忆标题
  text: string;            // 记忆内容
  label?: 'project' | 'preference' | 'technical' | 'context' | 'custom';
  metadata?: Record<string, any>;
}

interface MemoryStats {
  totalDocuments: number;
  documentsByLabel: Record<string, number>;
  oldestDocument?: number;
  newestDocument?: number;
}
```

#### 主要方法

```typescript
// 存储文档
function putDocument(input: MemoryDocument): Promise<Result>;

// 搜索文档
function findDocuments(query: string, options?: SearchOptions): Promise<SearchResult>;

// 问答查询
function askQuestion(question: string, options?: AskOptions): Promise<AnswerResult>;

// 获取统计信息
function getMemoryStats(): Promise<MemoryStats>;

// 获取时间线
function getMemoryTimeline(options?: TimelineOptions): Promise<TimelineResult>;

// 清空记忆
function clearAllMemory(): Promise<Result>;
```

#### 双后端架构

记忆系统支持两种存储后端：

1. **Memvid 后端**（推荐）
   - 高性能向量数据库
   - 支持语义搜索
   - 适合大量数据

2. **文件系统后端**
   - JSON 文件存储
   - 易于备份和迁移
   - 适合小规模数据

### 4. 技能系统 (skills-store.ts)

#### 数据结构

```typescript
interface Skill {
  name: string;              // 技能名称（唯一）
  description: string;        // 描述
  prompt: string;            // 提示词模板
  script?: {                 // 可选脚本
    type: 'javascript' | 'python';
    content?: string;
    path?: string;
  };
  tags?: string[];           // 标签
  createdAt: number;
  updatedAt: number;
}
```

#### 主要方法

```typescript
// 获取技能列表
function getSkillsList(): Promise<Skill[]>;

// 创建技能
function createSkill(config: SkillConfig): Promise<Result>;

// 删除技能
function deleteSkill(skillName: string): Promise<Result>;

// 获取技能元数据
function getSkillMetadata(skillName: string): Promise<SkillMetadata>;
```

### 5. MCP 服务器管理 (mcp-store.ts)

#### 数据结构

```typescript
interface McpServerConfig {
  name: string;              // 服务器名称
  command: string;           // 启动命令
  args: string[];            // 命令参数
  env?: Record<string, string>; // 环境变量
  enabled?: boolean;         // 是否启用
}

interface McpTemplate {
  name: string;
  displayName: string;
  description: string;
  command: string;
  args: string[];
  requiredEnvVars: string[];
}
```

#### 主要方法

```typescript
// 加载 MCP 服务器
function loadMcpServers(): Record<string, McpServerConfig>;

// 保存服务器
function saveMcpServer(name: string, config: McpServerConfig): void;

// 删除服务器
function deleteMcpServer(name: string): void;

// 验证配置
function validateMcpServer(config: McpServerConfig): ValidationResult;

// 测试服务器
function testMcpServer(config: McpServerConfig): Promise<TestResult>;

// 获取模板列表
function getMcpTemplates(): McpTemplate[];
```

### 6. 代理管理 (agents-store.ts)

#### 数据结构

```typescript
interface Agent {
  id: string;
  name: string;
  description: string;
  systemPrompt: string;
  allowedTools: string[];
  temperature: number;
  createdAt: number;
  updatedAt: number;
}

interface OrchestrationConfig {
  mode: 'parallel' | 'sequential' | 'dynamic';
  agentSequence: string[];
  maxConcurrency: number;
  stopOnFailure: boolean;
  enableAggregation: boolean;
  aggregationStrategy: 'all' | 'first' | 'majority' | 'consensus';
}
```

#### 主要方法

```typescript
// 获取代理列表
function getAgentsList(): Promise<Agent[]>;

// 创建代理
function createAgent(config: AgentConfig): Promise<Result>;

// 更新代理
function updateAgent(agentId: string, config: AgentConfig): Promise<Result>;

// 删除代理
function deleteAgent(agentId: string): Promise<Result>;

// 获取编排配置
function getOrchestrationConfig(): OrchestrationConfig;

// 保存编排配置
function saveOrchestrationConfig(config: OrchestrationConfig): Promise<Result>;
```

### 7. 钩子系统 (hooks-store.ts)

#### 数据结构

```typescript
interface HookConfig {
  type: 'preToolUse' | 'postToolUse';
  hook: string;              // 钩子名称
  command: string;           // 执行命令
  description?: string;
}

interface HooksStore {
  preToolUse: HookConfig[];
  postToolUse: HookConfig[];
}
```

#### 主要方法

```typescript
// 获取钩子配置
function getHooksConfig(): HooksStore;

// 保存钩子
function saveHook(config: HookConfig): Result;

// 删除钩子
function deleteHook(hookType: string, hookName: string): Result;
```

### 8. API 代理层 (api-proxy/)

#### SSE 服务器

创建本地 SSE 服务器，代理请求到 AI API：

```typescript
function createSSEServer(port: number, config: ApiConfig): http.Server;

// 启动服务器
const server = createSSEServer(3000, apiConfig);
server.listen(3000);
```

#### Token 计数

```typescript
// 计算消息的 token 数量
function countTokens(text: string, model?: string): number;

// 计算消息列表的 token 数量
function countMessagesTokens(messages: Message[], model?: string): number;
```

---

## API 参考

### IPC 通信 API

#### 主进程 → 渲染进程事件

```typescript
// 服务器事件
window.electronAPI.onServerEvent((event: string) => {
  const data = JSON.parse(event);
  // 处理事件
});
```

事件类型：
- `server-event`: 服务器推送事件
  - `session.list`: 会话列表更新
  - `session.history`: 会话历史加载
  - `message.delta`: 消息流式传输
  - `message.done`: 消息完成
  - `error`: 错误事件

#### 渲染进程 → 主进程调用

```typescript
// API 配置
window.electronAPI.getApiConfig(): Promise<ApiConfig>;
window.electronAPI.saveApiConfig(config: ApiConfig): Promise<Result>;
window.electronAPI.deleteApiConfig(configId: string): Promise<Result>;
window.electronAPI.testApiConnection(config: ApiConfig): Promise<TestResult>;

// 记忆系统
window.electronAPI.memoryPutDocument(input: MemoryDocument): Promise<Result>;
window.electronAPI.memoryFindDocuments(query: string, options?: SearchOptions): Promise<SearchResult>;
window.electronAPI.memoryAskQuestion(question: string): Promise<AnswerResult>;

// 技能管理
window.electronAPI.getSkillsList(): Promise<Skill[]>;
window.electronAPI.createSkill(config: SkillConfig): Promise<Result>;
window.electronAPI.deleteSkill(skillName: string): Promise<Result>;

// MCP 服务器
window.electronAPI.getMcpServers(): Promise<McpServerConfig[]>;
window.electronAPI.saveMcpServer(name: string, config: McpServerConfig): Promise<Result>;

// 代理管理
window.electronAPI.getAgentsList(): Promise<Agent[]>;
window.electronAPI.createAgent(config: AgentConfig): Promise<Result>;

// 会话管理
window.electronAPI.getSessionsList(): Promise<Session[]>;
window.electronAPI.getSessionHistory(sessionId: string): Promise<SessionHistory>;
window.electronAPI.recoverSession(sessionId: string): Promise<Result>;
window.electronAPI.deleteSession(sessionId: string): Promise<Result>;
```

### 前端状态管理 (Zustand)

```typescript
import { useAppStore } from './store/useAppStore';

// 获取状态
const messages = useAppStore(state => state.messages);
const currentSessionId = useAppStore(state => state.currentSessionId);

// 更新状态
const addMessage = useAppStore(state => state.addMessage);
const setCurrentSession = useAppStore(state => state.setCurrentSession);

// 订阅变化
useAppStore.subscribe(
  (state) => state.messages,
  (messages) => console.log('Messages updated:', messages)
);
```

---

## 插件开发指南

### 技能插件

#### 创建技能文件

在 `~/.claude/skills/` 目录创建技能文件：

**my-skill.md**:
```markdown
---
name: code-review
description: 代码审查技能
tags: [code, review]
---

请审查以下代码，指出潜在问题：

{{code}}

重点关注：
1. 代码风格
2. 性能问题
3. 安全漏洞
4. 边界情况处理
```

#### 创建带脚本的技能

**skill-with-script.json**:
```json
{
  "name": "data-processor",
  "description": "数据处理技能",
  "prompt": "处理以下数据：{{data}}",
  "script": {
    "type": "javascript",
    "content": "console.log('Processing data...');"
  }
}
```

### MCP 服务器插件

#### 创建自定义 MCP 服务器

1. 创建 npm 包：

```bash
mkdir my-mcp-server
cd my-mcp-server
npm init -y
npm install @modelcontextprotocol/sdk
```

2. 编写服务器代码：

```typescript
// src/index.ts
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';

const server = new Server({
  name: 'my-mcp-server',
  version: '1.0.0'
});

// 注册工具
server.setRequestHandler('tools/list', async () => ({
  tools: [
    {
      name: 'my_tool',
      description: '我的自定义工具',
      inputSchema: {
        type: 'object',
        properties: {
          param1: { type: 'string' }
        }
      }
    }
  ]
}));

// 启动服务器
const transport = new StdioServerTransport();
await server.connect(transport);
```

3. 在 AICowork 中配置：

```json
{
  "name": "my-server",
  "command": "node",
  "args": ["path/to/my-mcp-server/dist/index.js"]
}
```

### 主题定制

#### 创建自定义主题

1. 复制默认主题文件
2. 修改 CSS 变量
3. 在设置中应用主题

---

## 测试指南

### 运行测试

```bash
# 运行所有测试
pnpm test

# 监听模式
pnpm test:watch

# 覆盖率报告
pnpm test:coverage
```

### 编写测试

**单元测试示例**:

```typescript
// src/libs/__tests__/config-store.test.ts
import { describe, it, expect } from 'vitest';
import { validateApiConfig } from '../config-store';

describe('config-store', () => {
  it('should validate valid config', () => {
    const config = {
      id: 'cfg_test',
      name: 'Test Config',
      apiKey: 'sk-test',
      baseURL: 'https://api.test.com',
      model: 'test-model',
      apiType: 'anthropic' as const
    };

    const result = validateApiConfig(config);
    expect(result.valid).toBe(true);
    expect(result.errors).toHaveLength(0);
  });

  it('should reject invalid config', () => {
    const config = {
      id: 'cfg_test',
      name: '',
      apiKey: '',
      baseURL: '',
      model: ''
    };

    const result = validateApiConfig(config);
    expect(result.valid).toBe(false);
    expect(result.errors.length).toBeGreaterThan(0);
  });
});
```

### 集成测试

```typescript
// src/__tests__/integration/e2e.test.ts
import { describe, it, expect } from 'vitest';
import { loadAllApiConfigs, saveApiConfig } from '../../libs/config-store';

describe('API Config Integration', () => {
  it('should save and load config', () => {
    const config = {
      id: 'cfg_test',
      name: 'Test',
      apiKey: 'sk-test',
      baseURL: 'https://api.test.com',
      model: 'test-model',
      apiType: 'anthropic' as const
    };

    saveApiConfig(config);
    const loaded = loadAllApiConfigs();

    expect(loaded.configs).toContainEqual(config);
  });
});
```

---

## 打包发布

### 开发构建

```bash
# 编译 Electron 代码
pnpm transpile:electron

# 构建 React 代码
pnpm vite:build

# 完整构建
pnpm build
```

### 打包应用

```bash
# Windows (x64)
pnpm dist:win

# macOS (ARM64)
pnpm dist:mac-arm64

# macOS (Intel)
pnpm dist:mac-x64

# Linux
pnpm dist:linux

# 全平台
pnpm dist
```

### 打包配置

**electron-builder.json**:

```json
{
  "appId": "com.devagentforge.aicowork",
  "productName": "AICowork",
  "directories": {
    "output": "release"
  },
  "files": [
    "dist-electron/**/*",
    "dist-react/**/*"
  ],
  "mac": {
    "target": "dmg",
    "category": "public.app-category.productivity"
  },
  "win": {
    "target": ["portable", "nsis"]
  },
  "linux": {
    "target": ["AppImage", "deb"],
    "category": "Utility"
  }
}
```

### 代码签名（可选）

**Windows**:

```bash
# 安装证书
certutil -importPFX my-cert.pfx

# 修改 electron-builder.json
{
  "win": {
    "certificateFile": "path/to/my-cert.pfx",
    "certificatePassword": "password"
  }
}
```

**macOS**:

```bash
# 修改 electron-builder.json
{
  "mac": {
    "identity": "Developer ID Application: Your Name"
  }
}
```

---

## 贡献指南

### 代码规范

#### TypeScript

- 使用 TypeScript 5.9+ 严格模式
- 所有函数必须有类型注解
- 导出的类型必须使用 `export type`
- 避免使用 `any`，使用 `unknown` 替代

```typescript
// ✅ 好的做法
function processData(input: unknown): Result {
  if (typeof input === 'string') {
    return { success: true, data: input };
  }
  return { success: false, error: 'Invalid input' };
}

// ❌ 不好的做法
function processData(input: any): any {
  return input;
}
```

#### 命名约定

- 文件名：`kebab-case.ts` (如 `config-store.ts`)
- 接口/类型：`PascalCase` (如 `ApiConfig`)
- 变量/函数：`camelCase` (如 `saveApiConfig`)
- 常量：`UPPER_SNAKE_CASE` (如 `MAX_RETRIES`)
- 私有成员：`_camelCase` (如 `_internalMethod`)

#### 注释规范

```typescript
/**
 * 保存 API 配置到文件
 * @param config - API 配置对象
 * @returns 保存结果，成功返回 { success: true }
 * @throws {Error} 文件写入失败时抛出
 */
function saveApiConfig(config: ApiConfig): Result {
  // 实现
}
```

### 提交规范

使用 Conventional Commits 格式：

```bash
# 功能
git commit -m "feat: 添加技能管理功能"

# 修复
git commit -m "fix: 修复记忆系统搜索问题"

# 文档
git commit -m "docs: 更新 API 文档"

# 样式
git commit -m "style: 格式化代码"

# 重构
git commit -m "refactor: 重构配置存储模块"

# 测试
git commit -m "test: 添加单元测试"

# 构建配置
git commit -m "chore: 更新依赖版本"
```

### Pull Request 流程

1. Fork 项目
2. 创建特性分支：`git checkout -b feature/my-feature`
3. 提交更改：`git commit -m 'feat: add my feature'`
4. 推送分支：`git push origin feature/my-feature`
5. 创建 Pull Request

PR 标题格式：
- `feat: 简短描述`
- `fix: 简短描述`

PR 描述模板：
```markdown
## 变更类型
- [ ] 新功能
- [ ] Bug 修复
- [ ] 文档更新
- [ ] 代码重构

## 变更说明
描述你的更改...

## 测试
描述如何测试...

## 截图（如适用）
添加截图...
```

### 代码审查

检查项：
- [ ] 代码符合规范
- [ ] 包含必要的测试
- [ ] 文档已更新
- [ ] 无 console.log 或调试代码
- [ ] TypeScript 编译无错误
- [ ] 所有测试通过

---

## 常见问题

### Q: 如何调试 Electron 主进程？

A: 使用 VS Code 调试配置：

**.vscode/launch.json**:
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Main Process",
      "type": "node",
      "request": "launch",
      "cwd": "${workspaceFolder}",
      "runtimeExecutable": "${workspaceFolder}/node_modules/.bin/electron",
      "windows": {
        "runtimeExecutable": "${workspaceFolder}/node_modules/.bin/electron.cmd"
      },
      "args": ["."],
      "outputCapture": "std"
    }
  ]
}
```

### Q: 如何处理 native 模块兼容性？

A: 重建 native 模块：

```bash
# 重建 better-sqlite3
pnpm rebuild

# 或使用 electron-rebuild
npx electron-rebuild -f -w better-sqlite3
```

### Q: 如何添加新的语言？

A: 在 `src/ui/i18n/locales/` 添加语言文件：

```typescript
// src/ui/i18n/locales/my-lang.ts
export const translations = {
  translation: {
    "app.title": "My Title",
    "settings.api": "API Settings"
  }
};
```

然后在 `src/ui/i18n/config.ts` 注册：

```typescript
import { translations as myLang } from './locales/my-lang';

i18next.addResourceBundle('myLang', 'translation', myLang.translation);
```

### Q: 如何添加新的 AI 服务商？

A: 在 `src/electron/libs/api-adapter.ts` 添加厂商配置：

```typescript
export const API_PROVIDERS: Record<ApiProvider, ProviderConfig> = {
  // ... 现有配置
  'my-provider': {
    displayName: 'My Provider',
    baseURL: 'https://api.myprovider.com/v1',
    models: ['model-1', 'model-2'],
    requiresApiKey: true,
    defaultModel: 'model-1'
  }
};
```

---

## 附录

### A. 环境变量列表

| 变量名 | 说明 | 默认值 |
|--------|------|--------|
| `PORT` | 开发服务器端口 | 5173 |
| `ANTHROPIC_AUTH_TOKEN` | API 密钥 | - |
| `ANTHROPIC_BASE_URL` | API 基础 URL | - |
| `ANTHROPIC_MODEL` | 模型名称 | - |
| `NODE_ENV` | 环境 | development |

### B. 目录权限

**Windows**:
```
%APPDATA%\AICowork\
```

**macOS/Linux**:
```
~/.config/AICowork/
~/.claude/          # 技能和插件目录
```

### C. 相关链接

- [Electron 文档](https://www.electronjs.org/docs)
- [React 文档](https://react.dev)
- [Claude Agent SDK](https://github.com/anthropics/claude-agent-sdk)
- [MCP 协议](https://modelcontextprotocol.io)
- [i18next 文档](https://www.i18next.com)

---

**最后更新：2026-01-23**
**维护者：AICowork 开发团队**
