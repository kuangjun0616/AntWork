# AICowork å¼€å‘è€…æ–‡æ¡£

> **ç‰ˆæœ¬**: v0.1.0  
> **SDK**: @qwen-code/sdk v0.1.3  
> **æ›´æ–°æ—¥æœŸ**: 2026-02-03

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [å¼€å‘ç¯å¢ƒæ­å»º](#å¼€å‘ç¯å¢ƒæ­å»º)
4. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
5. [SDK é›†æˆæŒ‡å—](#sdk-é›†æˆæŒ‡å—)
6. [MCP æœåŠ¡å™¨å¼€å‘](#mcp-æœåŠ¡å™¨å¼€å‘)
7. [æŠ€èƒ½å¼€å‘æŒ‡å—](#æŠ€èƒ½å¼€å‘æŒ‡å—)
8. [æ„å»ºä¸å‘å¸ƒ](#æ„å»ºä¸å‘å¸ƒ)
9. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®å®šä½

AICowork æ˜¯ä¸€æ¬¾åŸºäº **[@qwen-code/sdk](https://github.com/QwenLM/qwen-code)** çš„ç°ä»£åŒ– AI æ¡Œé¢åº”ç”¨ï¼Œæ—¨åœ¨ä¸ºç”¨æˆ·æä¾›ï¼š

- ğŸ¯ **å¼€ç®±å³ç”¨**: æ— éœ€å¤æ‚é…ç½®ï¼Œå¿«é€Ÿä¸Šæ‰‹
- ğŸ”§ **é«˜åº¦å¯æ‰©å±•**: æ”¯æŒ MCPã€æŠ€èƒ½ã€ä»£ç†ç­‰æ‰©å±•æœºåˆ¶
- ğŸ›¡ï¸ **å®‰å…¨å¯é **: æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œæƒé™ç²¾ç»†æ§åˆ¶
- âš¡ **æ€§èƒ½ä¼˜åŒ–**: React 19 å¹¶å‘æ¸²æŸ“ï¼Œæµç•…ä½“éªŒ

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

```
å‰ç«¯å±‚:
â”œâ”€ React 19.2.3          # UI æ¡†æ¶ï¼ˆå¹¶å‘æ¸²æŸ“ï¼‰
â”œâ”€ TypeScript 5.9        # ç±»å‹å®‰å…¨
â”œâ”€ Tailwind CSS 4.1      # åŸå­åŒ– CSS
â”œâ”€ Zustand 5.0          # çŠ¶æ€ç®¡ç†
â””â”€ i18next 25.7         # å›½é™…åŒ–

æ¡Œé¢å±‚:
â”œâ”€ Electron 39.2.7      # è·¨å¹³å°æ¡Œé¢æ¡†æ¶
â”œâ”€ Vite 7.3             # æ„å»ºå·¥å…·
â””â”€ electron-builder     # æ‰“åŒ…å·¥å…·

AI å±‚:
â”œâ”€ @qwen-code/sdk 0.1.3 # AI å¯¹è¯æ ¸å¿ƒ
â”œâ”€ @memvid/sdk 2.0.120  # å‘é‡è®°å¿†å­˜å‚¨
â””â”€ @modelcontextprotocol/sdk # MCP åè®®æ”¯æŒ
```

### é¡¹ç›®ç»“æ„

```
AICowork/
â”œâ”€ src/
â”‚  â”œâ”€ electron/              # Electron ä¸»è¿›ç¨‹
â”‚  â”‚  â”œâ”€ main.ts            # åº”ç”¨å…¥å£
â”‚  â”‚  â”œâ”€ ipc-handlers.ts    # IPC é€šä¿¡å¤„ç†
â”‚  â”‚  â”œâ”€ libs/              # æ ¸å¿ƒåº“
â”‚  â”‚  â”‚  â””â”€ runner/         # SDK è¿è¡Œå™¨
â”‚  â”‚  â”œâ”€ managers/          # ç®¡ç†å™¨
â”‚  â”‚  â”‚  â”œâ”€ sdk-config-cache.ts  # SDK é…ç½®ç¼“å­˜
â”‚  â”‚  â”‚  â””â”€ mcp-server-manager.ts # MCP æœåŠ¡å™¨ç®¡ç†
â”‚  â”‚  â”œâ”€ services/          # æœåŠ¡å±‚
â”‚  â”‚  â”‚  â””â”€ qwen-settings.ts # Qwen é…ç½®æœåŠ¡
â”‚  â”‚  â”œâ”€ storage/           # å­˜å‚¨å±‚
â”‚  â”‚  â”‚  â”œâ”€ config-store.ts # API é…ç½®å­˜å‚¨
â”‚  â”‚  â”‚  â”œâ”€ memvid-store.ts # è®°å¿†å­˜å‚¨
â”‚  â”‚  â”‚  â”œâ”€ mcp-store.ts    # MCP é…ç½®å­˜å‚¨
â”‚  â”‚  â”‚  â””â”€ skills-store.ts # æŠ€èƒ½å­˜å‚¨
â”‚  â”‚  â””â”€ utils/             # å·¥å…·å‡½æ•°
â”‚  â”œâ”€ ui/                   # React æ¸²æŸ“è¿›ç¨‹
â”‚  â”‚  â”œâ”€ App.tsx           # åº”ç”¨æ ¹ç»„ä»¶
â”‚  â”‚  â”œâ”€ pages/            # é¡µé¢ç»„ä»¶
â”‚  â”‚  â”œâ”€ components/       # UI ç»„ä»¶
â”‚  â”‚  â”œâ”€ store/            # Zustand çŠ¶æ€
â”‚  â”‚  â””â”€ i18n/             # å›½é™…åŒ–é…ç½®
â”‚  â”œâ”€ shared/              # å…±äº«ä»£ç 
â”‚  â””â”€ types/               # TypeScript ç±»å‹å®šä¹‰
â”œâ”€ docs/                   # æ–‡æ¡£
â”œâ”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â””â”€ package.json
```

---

## æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI å±‚ (React 19)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ChatPage    â”‚  â”‚ SettingsPage â”‚  â”‚  Components  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                   Zustand Store + IPC Bridge                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Electron ä¸»è¿›ç¨‹ (Node.js)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ IPC Handlers â”‚  â”‚   Managers   â”‚  â”‚   Services   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Qwen Code SDK å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚    query()   â”‚  â”‚ MCP Servers  â”‚  â”‚    Agents    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å­˜å‚¨å±‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   SQLite     â”‚  â”‚    Memvid    â”‚  â”‚  FileSystem  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµè®¾è®¡

```
ç”¨æˆ·è¾“å…¥ â†’ UI ç»„ä»¶ â†’ Zustand Store â†’ IPC è°ƒç”¨ â†’ ä¸»è¿›ç¨‹å¤„ç†
                                                    â†“
                                              SDK Runner
                                                    â†“
                                         query() æµå¼å“åº”
                                                    â†“
                                         IPC äº‹ä»¶æ¨é€
                                                    â†“
                                         UI å®æ—¶æ›´æ–°
```

### IPC é€šä¿¡æ¶æ„

```typescript
// æ¸²æŸ“è¿›ç¨‹ â†’ ä¸»è¿›ç¨‹
window.electron.sendMessage(prompt, sessionId);

// ä¸»è¿›ç¨‹ â†’ æ¸²æŸ“è¿›ç¨‹ï¼ˆäº‹ä»¶æµï¼‰
onEvent({
  type: "stream.message",
  payload: { sessionId, message }
});

// åŒå‘é€šä¿¡ï¼ˆè¯·æ±‚-å“åº”ï¼‰
const config = await window.electron.getApiConfig();
```

---

## å¼€å‘ç¯å¢ƒæ­å»º

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/BrainPicker-L/AICowork.git
cd AICowork
```

### 2. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰
pnpm install

# æˆ–ä½¿ç”¨ npm
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ï¼š

```bash
# API é…ç½®ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥åœ¨ UI ä¸­é…ç½®ï¼‰
OPENAI_API_KEY=sk-xxx
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4

# æˆ–ä½¿ç”¨ Anthropic æ ¼å¼
ANTHROPIC_AUTH_TOKEN=sk-ant-xxx
ANTHROPIC_BASE_URL=https://api.anthropic.com
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ + Electron
pnpm dev

# æˆ–åˆ†åˆ«å¯åŠ¨
pnpm dev:vite    # å¯åŠ¨ Vite
pnpm dev:electron # å¯åŠ¨ Electron
```

### 5. å¼€å‘å·¥å…·

- **React DevTools**: å·²é›†æˆï¼ŒæŒ‰ `F12` æ‰“å¼€
- **Electron DevTools**: è‡ªåŠ¨æ‰“å¼€ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
- **æ—¥å¿—æŸ¥çœ‹**: 
  - ä¸»è¿›ç¨‹æ—¥å¿—: `~/.qwen/logs/main.log`
  - æ¸²æŸ“è¿›ç¨‹æ—¥å¿—: æµè§ˆå™¨æ§åˆ¶å°

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. SDK Runner (`src/electron/libs/runner/`)

**èŒè´£**: å°è£… Qwen Code SDK çš„è°ƒç”¨é€»è¾‘

**æ ¸å¿ƒæ–‡ä»¶**:
- `index.ts`: ä¸»å…¥å£ï¼Œæ‰§è¡Œ SDK query
- `types.ts`: ç±»å‹å®šä¹‰
- `permission-handler.ts`: æƒé™å¤„ç†
- `memory-manager.ts`: è®°å¿†ç®¡ç†
- `performance-monitor.ts`: æ€§èƒ½ç›‘æ§

**å…³é”®ä»£ç **:

```typescript
import { query } from "@qwen-code/sdk";

export async function runClaude(options: RunnerOptions): Promise<RunnerHandle> {
  const { prompt, session, onEvent } = options;
  
  // 1. è·å– API é…ç½®
  const config = await getCachedApiConfig();
  
  // 2. æ„å»ºç¯å¢ƒå˜é‡
  const env = buildEnvForConfig(config);
  
  // 3. åŠ è½½ MCP æœåŠ¡å™¨
  const mcpServers = await getMcpServers();
  
  // 4. åˆ›å»ºå¯¹è¯æµ
  const conversationStream = createConversationStream(
    inputQueue,
    session.id,
    prompt
  );
  
  // 5. æ‰§è¡Œ SDK query
  for await (const message of query(conversationStream, {
    env,
    cwd: session.cwd,
    mcpServers,
    permissionMode: "default",
    onPermissionRequest: handlePermissionRequest
  })) {
    onEvent({
      type: "stream.message",
      payload: { sessionId: session.id, message }
    });
  }
}
```

### 2. MCP æœåŠ¡å™¨ç®¡ç† (`src/electron/managers/mcp-server-manager.ts`)

**èŒè´£**: ç®¡ç† MCP æœåŠ¡å™¨é…ç½®å’Œç”Ÿå‘½å‘¨æœŸ

**é…ç½®æ–‡ä»¶**: `~/.qwen/settings.json`

```json
{
  "mcpServers": {
    "github": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_TOKEN": "your-token"
      }
    },
    "filesystem": {
      "command": "npx",
      "args": [
        "@modelcontextprotocol/server-filesystem",
        "/path/to/allowed"
      ]
    }
  }
}
```

**å…³é”®å‡½æ•°**:

```typescript
// è·å–æ‰€æœ‰ MCP æœåŠ¡å™¨é…ç½®
export async function getMcpServers(): Promise<Record<string, McpServerConfig>> {
  const configs = await loadMcpServers();
  const servers: Record<string, McpServerConfig> = {};
  
  for (const [name, config] of Object.entries(configs)) {
    // è·³è¿‡ç¦ç”¨çš„æœåŠ¡å™¨
    if (config.disabled || !config.enabled) continue;
    
    // ç§»é™¤ type å­—æ®µï¼Œè®© SDK è‡ªåŠ¨è¯†åˆ«
    const { type, ...cleanConfig } = config;
    servers[name] = cleanConfig;
  }
  
  return servers;
}
```

### 3. è®°å¿†å­˜å‚¨ (`src/electron/storage/memvid-store.ts`)

**èŒè´£**: ä½¿ç”¨ Memvid SDK ç®¡ç†å‘é‡è®°å¿†

**å­˜å‚¨ä½ç½®**: `~/.qwen/memvid/memory.mv2`

**å…³é”®ä»£ç **:

```typescript
import { use, create } from '@memvid/sdk';

class MemvidStore {
  private memory: any = null;
  
  async initialize() {
    const fileExists = await fs.access(this.filePath)
      .then(() => true)
      .catch(() => false);
    
    if (fileExists) {
      this.memory = await use('basic', this.filePath);
    } else {
      this.memory = await create(this.filePath, 'basic');
    }
  }
  
  async putDocument(input: MemoryDocumentInput) {
    const doc = await this.memory.put({
      title: input.title,
      label: input.label || 'general',
      text: input.text,
      metadata: input.metadata || {},
    });
    
    await this.memory.seal();
    return { success: true, id: doc?.id };
  }
  
  async findDocuments(query: string, options = {}) {
    const results = await this.memory.find(query, {
      mode: options.mode || 'lex',
      k: options.k || 10,
    });
    
    return { success: true, results };
  }
}
```

### 4. æŠ€èƒ½å­˜å‚¨ (`src/electron/storage/skills-store.ts`)

**èŒè´£**: ç®¡ç†ç”¨æˆ·è‡ªå®šä¹‰æŠ€èƒ½

**å­˜å‚¨ä½ç½®**: `~/.qwen/skills/`

**æŠ€èƒ½ç»“æ„**:

```
~/.qwen/skills/
â””â”€ my-skill/
   â”œâ”€ SKILL.md          # å¿…éœ€ï¼šæŠ€èƒ½å®šä¹‰
   â””â”€ my-skill.js       # å¯é€‰ï¼šè„šæœ¬æ–‡ä»¶
```

**SKILL.md æ ¼å¼**:

```markdown
---
name: my-skill
description: æˆ‘çš„è‡ªå®šä¹‰æŠ€èƒ½
---

# æŠ€èƒ½æ ‡é¢˜

æŠ€èƒ½çš„æç¤ºè¯å†…å®¹...

æ”¯æŒå˜é‡æ›¿æ¢ï¼š{{input}}
```

**å…³é”®å‡½æ•°**:

```typescript
export async function getSkillsList(): Promise<SkillConfig[]> {
  const skillsDir = getSkillsDir();
  const entries = await fs.readdir(skillsDir, { withFileTypes: true });
  const skills: SkillConfig[] = [];
  
  for (const entry of entries) {
    if (entry.isDirectory()) {
      const skillFile = join(skillsDir, entry.name, 'SKILL.md');
      
      try {
        await fs.access(skillFile);
        const content = await fs.readFile(skillFile, 'utf-8');
        const skill = parseSkillMarkdown(content, entry.name);
        skills.push(skill);
      } catch {
        // è·³è¿‡æ— æ•ˆæŠ€èƒ½
      }
    }
  }
  
  return skills;
}
```

---

## SDK é›†æˆæŒ‡å—

### 1. åŸºæœ¬ç”¨æ³•

```typescript
import { query } from "@qwen-code/sdk";

// åˆ›å»ºå¯¹è¯æµ
async function* createMessages() {
  yield {
    type: 'user',
    uuid: crypto.randomUUID(),
    session_id: 'session-1',
    message: {
      role: 'user',
      content: 'ä½ å¥½'
    },
    parent_tool_use_id: null
  };
}

// æ‰§è¡ŒæŸ¥è¯¢
for await (const message of query(createMessages(), {
  env: {
    OPENAI_API_KEY: 'sk-xxx',
    OPENAI_BASE_URL: 'https://api.openai.com/v1',
    OPENAI_MODEL: 'gpt-4'
  },
  cwd: process.cwd()
})) {
  console.log(message);
}
```

### 2. MCP æœåŠ¡å™¨é›†æˆ

```typescript
const mcpServers = {
  "memory": {
    "command": "node",
    "args": ["./memory-server.js"]
  },
  "github": {
    "command": "npx",
    "args": ["@modelcontextprotocol/server-github"],
    "env": {
      "GITHUB_TOKEN": process.env.GITHUB_TOKEN
    }
  }
};

for await (const message of query(messages, {
  mcpServers,
  // ...å…¶ä»–é…ç½®
})) {
  // å¤„ç†æ¶ˆæ¯
}
```

### 3. æƒé™å¤„ç†

```typescript
for await (const message of query(messages, {
  permissionMode: "default", // é»˜è®¤æ¨¡å¼ï¼Œéœ€è¦ç”¨æˆ·ç¡®è®¤
  onPermissionRequest: async (toolUseId, toolName, input) => {
    // æ˜¾ç¤ºæƒé™è¯·æ±‚ UI
    const approved = await showPermissionDialog(toolName, input);
    
    // è¿”å›ç”¨æˆ·å†³ç­–
    return {
      type: 'permission_response',
      tool_use_id: toolUseId,
      approved
    };
  }
})) {
  // å¤„ç†æ¶ˆæ¯
}
```

### 4. ä»£ç†é…ç½®

```typescript
const agents = {
  "code-reviewer": {
    "description": "ä»£ç å®¡æŸ¥ä¸“å®¶",
    "prompt": "ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ä»£ç å®¡æŸ¥ä¸“å®¶...",
    "tools": ["Read", "Edit"],
    "model": "sonnet"
  }
};

for await (const message of query(messages, {
  agents,
  agent: "code-reviewer", // æ¿€æ´»ç‰¹å®šä»£ç†
  // ...å…¶ä»–é…ç½®
})) {
  // å¤„ç†æ¶ˆæ¯
}
```

---

## MCP æœåŠ¡å™¨å¼€å‘

### 1. åˆ›å»º MCP æœåŠ¡å™¨

ä½¿ç”¨ SDK æä¾›çš„å·¥å…·å¿«é€Ÿåˆ›å»ºï¼š

```typescript
import { createSdkMcpServer, tool } from "@qwen-code/sdk";
import { z } from "zod";

const server = createSdkMcpServer({
  name: "my-tools",
  version: "1.0.0",
  tools: [
    tool(
      "hello",
      "æ‰“æ‹›å‘¼",
      {
        name: z.string().describe("åå­—")
      },
      async (args) => {
        return {
          content: [{
            type: "text",
            text: `ä½ å¥½ï¼Œ${args.name}ï¼`
          }]
        };
      }
    )
  ]
});

// å¯åŠ¨æœåŠ¡å™¨
server.listen();
```

### 2. é›†æˆåˆ° AICowork

**æ–¹å¼ä¸€ï¼šé…ç½®æ–‡ä»¶**

åœ¨ `~/.qwen/settings.json` ä¸­æ·»åŠ ï¼š

```json
{
  "mcpServers": {
    "my-tools": {
      "command": "node",
      "args": ["./my-tools-server.js"]
    }
  }
}
```

**æ–¹å¼äºŒï¼šä»£ç é›†æˆ**

åœ¨ `src/electron/utils/` åˆ›å»ºæœåŠ¡å™¨æ–‡ä»¶ï¼š

```typescript
// src/electron/utils/my-tools-mcp-server.ts
import { createSdkMcpServer, tool } from "@qwen-code/sdk";

export async function createMyToolsServer() {
  return createSdkMcpServer({
    name: "my-tools",
    version: "1.0.0",
    tools: [
      // å®šä¹‰å·¥å…·...
    ]
  });
}
```

ç„¶ååœ¨ `sdk-config-cache.ts` ä¸­æ³¨å†Œï¼š

```typescript
// è·å–è‡ªå®šä¹‰ MCP æœåŠ¡å™¨
const myToolsServer = await createMyToolsServer();

const allMcpServers = {
  'my-tools': myToolsServer,
  ...externalMcpServers
};
```

### 3. MCP å·¥å…·æœ€ä½³å®è·µ

**å·¥å…·å‘½å**:
- ä½¿ç”¨æ¸…æ™°çš„åŠ¨è¯ï¼š`search`, `create`, `update`, `delete`
- é¿å…ç¼©å†™ï¼š`get_user` è€Œé `get_usr`

**å‚æ•°è®¾è®¡**:
- ä½¿ç”¨ Zod è¿›è¡Œç±»å‹éªŒè¯
- æä¾›è¯¦ç»†çš„æè¿°ä¿¡æ¯
- è®¾ç½®åˆç†çš„é»˜è®¤å€¼

**é”™è¯¯å¤„ç†**:
```typescript
tool("risky_operation", "å±é™©æ“ä½œ", schema, async (args) => {
  try {
    const result = await performOperation(args);
    return {
      content: [{ type: "text", text: result }]
    };
  } catch (error) {
    return {
      content: [{
        type: "text",
        text: `æ“ä½œå¤±è´¥: ${error.message}`
      }],
      isError: true
    };
  }
});
```

---

## æŠ€èƒ½å¼€å‘æŒ‡å—

### 1. åˆ›å»ºæŠ€èƒ½

**æ­¥éª¤**:

1. åœ¨ `~/.qwen/skills/` åˆ›å»ºæŠ€èƒ½æ–‡ä»¶å¤¹
2. åˆ›å»º `SKILL.md` æ–‡ä»¶
3. ï¼ˆå¯é€‰ï¼‰åˆ›å»ºè„šæœ¬æ–‡ä»¶

**ç¤ºä¾‹ï¼šä»£ç å®¡æŸ¥æŠ€èƒ½**

```bash
mkdir -p ~/.qwen/skills/code-review
cd ~/.qwen/skills/code-review
```

åˆ›å»º `SKILL.md`:

```markdown
---
name: code-review
description: ä»£ç å®¡æŸ¥åŠ©æ‰‹
---

# ä»£ç å®¡æŸ¥

è¯·å¯¹ä»¥ä¸‹ä»£ç è¿›è¡Œå…¨é¢å®¡æŸ¥ï¼š

## å®¡æŸ¥è¦ç‚¹

1. **ä»£ç é£æ ¼**: æ˜¯å¦ç¬¦åˆå›¢é˜Ÿè§„èŒƒ
2. **æ½œåœ¨é—®é¢˜**: Bugã€å®‰å…¨æ¼æ´ã€æ€§èƒ½é—®é¢˜
3. **æœ€ä½³å®è·µ**: æ˜¯å¦éµå¾ªæœ€ä½³å®è·µ
4. **å¯ç»´æŠ¤æ€§**: ä»£ç æ˜¯å¦æ˜“äºç†è§£å’Œç»´æŠ¤

## ä»£ç 

```
{{input}}
```

## è¾“å‡ºæ ¼å¼

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š

### âœ… ä¼˜ç‚¹
- ...

### âš ï¸ é—®é¢˜
- ...

### ğŸ’¡ å»ºè®®
- ...
```

### 2. ä½¿ç”¨æŠ€èƒ½

åœ¨å¯¹è¯ä¸­ä½¿ç”¨ï¼š

```
/code-review --input="src/App.tsx"
```

æˆ–é€šè¿‡ UIï¼š

1. æ‰“å¼€è®¾ç½® â†’ æŠ€èƒ½ç®¡ç†
2. æ‰¾åˆ° `code-review` æŠ€èƒ½
3. ç‚¹å‡»"ä½¿ç”¨"æŒ‰é’®

### 3. æŠ€èƒ½å˜é‡

æ”¯æŒçš„å˜é‡ï¼š

- `{{input}}`: ç”¨æˆ·è¾“å…¥
- `{{file}}`: æ–‡ä»¶è·¯å¾„
- `{{selection}}`: é€‰ä¸­çš„æ–‡æœ¬
- `{{clipboard}}`: å‰ªè´´æ¿å†…å®¹

**ç¤ºä¾‹**:

```markdown
# ç¿»è¯‘åŠ©æ‰‹

è¯·å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘æˆ {{target_language}}ï¼š

{{input}}
```

ä½¿ç”¨ï¼š

```
/translate --target_language="English" --input="ä½ å¥½ä¸–ç•Œ"
```

### 4. è„šæœ¬æŠ€èƒ½ï¼ˆé«˜çº§ï¼‰

åˆ›å»º `code-review.js`:

```javascript
// code-review.js
module.exports = async function(args) {
  const { input } = args;
  
  // æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘
  const analysis = await analyzeCode(input);
  
  // è¿”å›ç»“æœ
  return {
    success: true,
    result: analysis
  };
};

async function analyzeCode(code) {
  // ä»£ç åˆ†æé€»è¾‘
  return {
    issues: [],
    suggestions: []
  };
}
```

---

## æ„å»ºä¸å‘å¸ƒ

### 1. æ„å»ºåº”ç”¨

```bash
# æ„å»ºæ‰€æœ‰å¹³å°
pnpm dist

# æ„å»ºç‰¹å®šå¹³å°
pnpm dist:mac-arm64   # macOS ARM64
pnpm dist:mac-x64     # macOS x64
pnpm dist:win         # Windows
pnpm dist:linux       # Linux
```

### 2. æ„å»ºé…ç½®

ç¼–è¾‘ `electron-builder.json`:

```json
{
  "appId": "com.aicowork.app",
  "productName": "AICowork",
  "directories": {
    "output": "dist"
  },
  "files": [
    "dist-electron/**/*",
    "dist/**/*",
    "package.json"
  ],
  "mac": {
    "target": ["dmg", "zip"],
    "category": "public.app-category.productivity"
  },
  "win": {
    "target": ["nsis", "portable"]
  },
  "linux": {
    "target": ["AppImage", "deb"]
  }
}
```

### 3. å‘å¸ƒæµç¨‹

1. **æ›´æ–°ç‰ˆæœ¬å·**

```bash
npm version patch  # 0.1.0 â†’ 0.1.1
npm version minor  # 0.1.0 â†’ 0.2.0
npm version major  # 0.1.0 â†’ 1.0.0
```

2. **æ„å»ºåº”ç”¨**

```bash
pnpm dist
```

3. **åˆ›å»º GitHub Release**

```bash
git tag v0.1.1
git push origin v0.1.1
```

4. **ä¸Šä¼ æ„å»ºäº§ç‰©**

å°† `dist/` ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸Šä¼ åˆ° GitHub Release

---

## å¸¸è§é—®é¢˜

### 1. SDK ç›¸å…³

**Q: å¦‚ä½•åˆ‡æ¢ API æä¾›å•†ï¼Ÿ**

A: ä¿®æ”¹ç¯å¢ƒå˜é‡æˆ– UI é…ç½®ï¼š

```bash
# OpenAI
OPENAI_API_KEY=sk-xxx
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4

# Anthropic
ANTHROPIC_AUTH_TOKEN=sk-ant-xxx
ANTHROPIC_BASE_URL=https://api.anthropic.com
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
```

**Q: å¦‚ä½•è°ƒè¯• SDK è°ƒç”¨ï¼Ÿ**

A: æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š

```bash
# ä¸»è¿›ç¨‹æ—¥å¿—
tail -f ~/.qwen/logs/main.log

# æˆ–åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—
import { log } from './logger';
log.debug('SDK query started', { sessionId });
```

### 2. MCP ç›¸å…³

**Q: MCP æœåŠ¡å™¨æ— æ³•å¯åŠ¨ï¼Ÿ**

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. å‘½ä»¤è·¯å¾„æ˜¯å¦æ­£ç¡®
2. ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®
3. ä¾èµ–æ˜¯å¦å®‰è£…ï¼ˆå¦‚ `npx` å‘½ä»¤éœ€è¦ Node.jsï¼‰
4. æŸ¥çœ‹æ—¥å¿—ï¼š`~/.qwen/logs/main.log`

**Q: å¦‚ä½•æµ‹è¯• MCP æœåŠ¡å™¨ï¼Ÿ**

A: ä½¿ç”¨ MCP Inspectorï¼š

```bash
npx @modelcontextprotocol/inspector node ./my-server.js
```

### 3. è®°å¿†ç³»ç»Ÿ

**Q: è®°å¿†å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ**

A: `~/.qwen/memvid/memory.mv2`

**Q: å¦‚ä½•æ¸…ç©ºè®°å¿†ï¼Ÿ**

A: 
1. é€šè¿‡ UIï¼šè®¾ç½® â†’ è®°å¿†ç®¡ç† â†’ æ¸…ç©ºè®°å¿†
2. æ‰‹åŠ¨åˆ é™¤ï¼š`rm ~/.qwen/memvid/memory.mv2`

### 4. å¼€å‘è°ƒè¯•

**Q: å¦‚ä½•æŸ¥çœ‹æ¸²æŸ“è¿›ç¨‹æ—¥å¿—ï¼Ÿ**

A: æŒ‰ `F12` æ‰“å¼€ DevToolsï¼ŒæŸ¥çœ‹ Console

**Q: å¦‚ä½•é‡æ–°åŠ è½½åº”ç”¨ï¼Ÿ**

A: æŒ‰ `Cmd+R` (macOS) æˆ– `Ctrl+R` (Windows/Linux)

**Q: å¦‚ä½•æ¸…é™¤åº”ç”¨æ•°æ®ï¼Ÿ**

A: åˆ é™¤ç”¨æˆ·æ•°æ®ç›®å½•ï¼š

```bash
# macOS
rm -rf ~/Library/Application\ Support/aicowork

# Windows
rmdir /s %APPDATA%\aicowork

# Linux
rm -rf ~/.config/aicowork
```

---

## å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- [Qwen Code SDK](https://github.com/QwenLM/qwen-code)
- [Model Context Protocol](https://modelcontextprotocol.io/)
- [Memvid SDK](https://github.com/memvid/memvid)
- [Electron æ–‡æ¡£](https://www.electronjs.org/docs)
- [React 19 æ–‡æ¡£](https://react.dev/)

### ç¤¾åŒºèµ„æº

- [MCP æœåŠ¡å™¨åˆ—è¡¨](https://github.com/modelcontextprotocol/servers)
- [Qwen æ¨¡å‹æ–‡æ¡£](https://qwen.readthedocs.io/)
- [AICowork GitHub](https://github.com/BrainPicker-L/AICowork)

### å¼€å‘å·¥å…·

- [VS Code](https://code.visualstudio.com/)
- [React DevTools](https://react.dev/learn/react-developer-tools)
- [Electron DevTools](https://www.electronjs.org/docs/latest/tutorial/devtools-extension)

---

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add amazing feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/amazing-feature`
5. æäº¤ Pull Request

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ TypeScript
- éµå¾ª ESLint è§„åˆ™
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- ç¼–å†™å•å…ƒæµ‹è¯•

### æäº¤è§„èŒƒ

```
feat: æ–°åŠŸèƒ½
fix: Bug ä¿®å¤
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼
refactor: é‡æ„
test: æµ‹è¯•
chore: æ„å»º/å·¥å…·
```

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [AGPL-3.0](../LICENSE.txt) è®¸å¯è¯ã€‚

---

## è”ç³»æ–¹å¼

- **GitHub**: https://github.com/BrainPicker-L/AICowork
- **Issues**: https://github.com/BrainPicker-L/AICowork/issues
- **Email**: alan@example.com

---

**Happy Coding! ğŸš€**
