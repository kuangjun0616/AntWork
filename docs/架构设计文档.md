# AICowork æ¶æ„è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v0.1.0
> **ä½œè€…**: Alan <none>
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-24
> **æœ€åæ›´æ–°**: 2026-01-24
> **æ¶æ„æ¨¡å¼**: Electron + MVVM + åˆ†å±‚æ¶æ„

---

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
2. [åˆ†å±‚æ¶æ„è®¾è®¡](#åˆ†å±‚æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒæ¨¡å—æ¶æ„](#æ ¸å¿ƒæ¨¡å—æ¶æ„)
4. [æ•°æ®æµè®¾è®¡](#æ•°æ®æµè®¾è®¡)
5. [çŠ¶æ€ç®¡ç†æ¶æ„](#çŠ¶æ€ç®¡ç†æ¶æ„)
6. [é€šä¿¡æ¶æ„](#é€šä¿¡æ¶æ„)
7. [å­˜å‚¨æ¶æ„](#å­˜å‚¨æ¶æ„)
8. [å®‰å…¨æ¶æ„](#å®‰å…¨æ¶æ„)
9. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
10. [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)

---

## æ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         è¡¨ç°å±‚ (Presentation)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  èŠå¤©ç•Œé¢     â”‚  â”‚  è®¾ç½®ç•Œé¢     â”‚  â”‚  æ’ä»¶ç•Œé¢     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                   React 19 + Tailwind CSS + i18next             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡é€»è¾‘å±‚ (Business)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ä¼šè¯ç®¡ç†     â”‚  â”‚  æ¶ˆæ¯å¤„ç†     â”‚  â”‚  è®°å¿†ç®¡ç†     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  æŠ€èƒ½ç³»ç»Ÿ     â”‚  â”‚  MCP ç®¡ç†     â”‚  â”‚  ä»£ç†ç¼–æ’     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      Zustand + React Hooks                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æœåŠ¡å±‚ (Service)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  API ä»£ç†     â”‚  â”‚  é…ç½®ç®¡ç†     â”‚  â”‚  æ—¥å¿—æœåŠ¡     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  è®°å¿†æœåŠ¡     â”‚  â”‚  æŠ€èƒ½æœåŠ¡     â”‚  â”‚  MCP æœåŠ¡     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                    TypeScript + Node.js                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®å±‚ (Data)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  SQLite      â”‚  â”‚  Memvid      â”‚  â”‚  FileSystem  â”‚          â”‚
â”‚  â”‚  (ä¼šè¯æ•°æ®)   â”‚  â”‚  (å‘é‡å­˜å‚¨)   â”‚  â”‚  (æ–‡ä»¶å¤‡ä»½)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                  better-sqlite3 + @memvid/sdk                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å¤–éƒ¨æœåŠ¡ (External)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  AI APIs     â”‚  â”‚  MCP Servers â”‚  â”‚  æœ¬åœ°æ–‡ä»¶     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ¶æ„è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ | åº”ç”¨åœºæ™¯ |
|-----|------|---------|
| **åˆ†å±‚æ¶æ„** | èŒè´£åˆ†ç¦»ï¼Œæ¯å±‚ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½ | æ•´ä½“æ¶æ„ |
| **å•å‘æ•°æ®æµ** | æ•°æ®ä»ä¸Šå¾€ä¸‹æµåŠ¨ï¼Œæ˜“äºè¿½è¸ª | çŠ¶æ€ç®¡ç† |
| **ä¾èµ–æ³¨å…¥** | é™ä½è€¦åˆï¼Œæé«˜å¯æµ‹è¯•æ€§ | æœåŠ¡å±‚ |
| **æ¥å£éš”ç¦»** | å®šä¹‰æ¸…æ™°çš„æ¥å£å¥‘çº¦ | IPC é€šä¿¡ |
| **å¼€é—­åŸåˆ™** | å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ | æ’ä»¶ç³»ç»Ÿ |
| **å•ä¸€èŒè´£** | æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä»¶äº‹ | æ‰€æœ‰æ¨¡å— |
| **æœ€å°æƒé™** | é™åˆ¶è®¿é—®æƒé™ï¼Œæé«˜å®‰å…¨æ€§ | IPC é€šä¿¡ |

---

## åˆ†å±‚æ¶æ„è®¾è®¡

### 1. è¡¨ç°å±‚ (Presentation Layer)

#### èŒè´£
- æ¸²æŸ“ç”¨æˆ·ç•Œé¢
- å¤„ç†ç”¨æˆ·äº¤äº’
- å±•ç¤ºæ•°æ®

#### æŠ€æœ¯æ ˆ
- **React 19**: å¹¶å‘æ¸²æŸ“ã€Suspenseã€Transitions
- **Tailwind CSS 4**: åŸå­åŒ– CSS
- **i18next**: å›½é™…åŒ–æ”¯æŒ
- **react-markdown**: Markdown æ¸²æŸ“

#### ç›®å½•ç»“æ„
```
src/ui/
â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ ChatPage.tsx
â”‚   â”œâ”€â”€ SettingsPage.tsx
â”‚   â””â”€â”€ PluginsPage.tsx
â”œâ”€â”€ components/         # UI ç»„ä»¶
â”‚   â”œâ”€â”€ Chat/
â”‚   â”œâ”€â”€ Settings/
â”‚   â””â”€â”€ Common/
â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰ Hooks
â”œâ”€â”€ store/             # Zustand çŠ¶æ€
â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
```

#### æ•°æ®æµ
```
ç”¨æˆ·æ“ä½œ â†’ ç»„ä»¶äº‹ä»¶å¤„ç† â†’ Zustand Store â†’ IPC è°ƒç”¨ â†’ ä¸»è¿›ç¨‹
```

---

### 2. ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)

#### èŒè´£
- å®ç°ä¸šåŠ¡è§„åˆ™
- åè°ƒå¤šä¸ªæœåŠ¡
- ç®¡ç†åº”ç”¨çŠ¶æ€

#### æ ¸å¿ƒæ¨¡å—

##### ä¼šè¯ç®¡ç†
```typescript
class SessionManager {
  createSession(title: string): Session
  loadSessions(): Session[]
  deleteSession(id: string): void
  updateSession(id: string, updates: Partial<Session>): void
}
```

##### æ¶ˆæ¯å¤„ç†
```typescript
class MessageProcessor {
  sendMessage(sessionId: string, content: string): Promise<string>
  processStream(stream: AsyncIterable<string>): AsyncIterable<string>
  handleToolUse(tools: ToolUse[]): Promise<ToolResult[]>
}
```

##### è®°å¿†ç®¡ç†
```typescript
class MemoryManager {
  store(title: string, text: string, label: MemoryLabel): Promise<void>
  search(query: string, k?: number): Promise<MemoryResult[]>
  ask(question: string): Promise<string>
}
```

---

### 3. æœåŠ¡å±‚ (Service Layer)

#### èŒè´£
- å°è£…å¤–éƒ¨ API è°ƒç”¨
- å®ç°å¯å¤ç”¨çš„ä¸šåŠ¡é€»è¾‘
- æä¾›ç»Ÿä¸€çš„æ•°æ®æ¥å£

#### æ ¸å¿ƒæœåŠ¡

##### API ä»£ç†æœåŠ¡
```typescript
interface ApiProvider {
  name: string;
  stream(messages: Message[], options: RequestOptions): AsyncIterable<string>;
  validateConfig(config: ApiConfig): Promise<boolean>;
}

class ApiProxyService {
  private providers: Map<string, ApiProvider>;

  register(key: string, provider: ApiProvider): void
  async sendMessage(messages: Message[], config: ApiConfig): Promise<string>
}
```

##### é…ç½®ç®¡ç†æœåŠ¡
```typescript
class ConfigService {
  private db: better_sqlite3.Database;

  addConfig(config: ApiConfig): void
  getConfigs(): ApiConfig[]
  getActiveConfig(): ApiConfig | null
  setActiveConfig(id: string): void
  deleteConfig(id: string): void
}
```

##### è®°å¿†æœåŠ¡
```typescript
class MemoryService {
  private memvid: MemvidClient;
  private fsStorage: FsStorage;

  async store(memory: Memory): Promise<void>
  async search(query: string, options?: SearchOptions): Promise<MemoryResult[]>
  async ask(question: string): Promise<string>
}
```

---

### 4. æ•°æ®å±‚ (Data Layer)

#### èŒè´£
- æ•°æ®æŒä¹…åŒ–
- æ•°æ®æŸ¥è¯¢
- æ•°æ®å¤‡ä»½

#### å­˜å‚¨æ–¹æ¡ˆ

##### SQLite (ä¼šè¯æ•°æ®)
```typescript
class SessionDatabase {
  private db: better_sqlite3.Database;

  // WAL æ¨¡å¼ï¼Œæé«˜å¹¶å‘æ€§èƒ½
  constructor() {
    this.db.pragma('journal_mode = WAL');
    this.db.pragma('synchronous = NORMAL');
  }

  createSession(session: Session): void
  getMessages(sessionId: string): Message[]
  addMessage(sessionId: string, message: Message): void
}
```

##### Memvid (å‘é‡å­˜å‚¨)
```typescript
class VectorStore {
  private client: MemvidClient;

  async store(text: string, metadata: Record<string, any>): Promise<void>
  async search(query: string, topK: number): Promise<VectorResult[]>
}
```

##### FileSystem (æ–‡ä»¶å¤‡ä»½)
```typescript
class FileBackup {
  private baseDir: string;

  async save(memory: Memory): Promise<void>
  async load(id: string): Promise<Memory | null>
}
```

---

## æ ¸å¿ƒæ¨¡å—æ¶æ„

### 1. AI å¯¹è¯ç³»ç»Ÿ

#### æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¯¹è¯ç®¡ç†å™¨                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ä¼šè¯ç®¡ç†     â”‚  â”‚  ä¸Šä¸‹æ–‡ç®¡ç†   â”‚  â”‚  æµå¼å¤„ç†     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API ä»£ç†å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ OpenAI   â”‚  â”‚ Anthropicâ”‚  â”‚ æ™ºè°± AI  â”‚  ...        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®æµ
```
ç”¨æˆ·è¾“å…¥ â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ ä¸Šä¸‹æ–‡æ„å»º â†’ API è°ƒç”¨ â†’ æµå¼å“åº” â†’ æ¶ˆæ¯æ¸²æŸ“
```

#### å…³é”®ä»£ç 
```typescript
// å¯¹è¯ç®¡ç†å™¨
class ChatManager {
  private contextBuilder: ContextBuilder;
  private apiProxy: ApiProxyService;

  async sendMessage(userMessage: string): AsyncIterable<string> {
    // 1. æ„å»ºä¸Šä¸‹æ–‡
    const context = await this.contextBuilder.build();

    // 2. è°ƒç”¨ API
    const stream = await this.apiProxy.stream([...context, userMessage]);

    // 3. è¿”å›æµå¼å“åº”
    return stream;
  }
}
```

---

### 2. è®°å¿†ç³»ç»Ÿæ¶æ„

#### åŒåç«¯è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è®°å¿†ç®¡ç†å™¨                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è®°å¿†å­˜å‚¨     â”‚  â”‚  è®°å¿†æ£€ç´¢     â”‚  â”‚  è®°å¿†é—®ç­”     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†•                    â†•                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Memvid        â”‚  â”‚    Memvid        â”‚  â”‚  RAG ç”Ÿæˆå™¨      â”‚
â”‚  (å‘é‡æ•°æ®åº“)     â”‚  â”‚  (è¯­ä¹‰æœç´¢)      â”‚  â”‚  (æ£€ç´¢å¢å¼ºç”Ÿæˆ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FileSystem      â”‚
â”‚  (æ–‡ä»¶ç³»ç»Ÿå¤‡ä»½)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å­˜å‚¨æµç¨‹
```
ç”¨æˆ·è¾“å…¥ â†’ æ–‡æœ¬é¢„å¤„ç† â†’ å‘é‡åŒ– â†’ å­˜å‚¨(Memvid + FileSystem)
```

#### æ£€ç´¢æµç¨‹
```
æŸ¥è¯¢ â†’ å‘é‡åŒ– â†’ ç›¸ä¼¼åº¦æœç´¢(Top-K) â†’ ç»“æœæ’åº â†’ è¿”å›
```

#### RAG é—®ç­”æµç¨‹
```
é—®é¢˜ â†’ è¯­ä¹‰æœç´¢ â†’ æ£€ç´¢ç›¸å…³è®°å¿† â†’ æ„å»ºæç¤ºè¯ â†’ AI ç”Ÿæˆ â†’ è¿”å›ç­”æ¡ˆ
```

---

### 3. æŠ€èƒ½ç³»ç»Ÿæ¶æ„

#### æŠ€èƒ½ç”Ÿå‘½å‘¨æœŸ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰«æ   â”‚ â†’ â”‚ è§£æ   â”‚ â†’ â”‚ æ³¨å†Œ   â”‚ â†’ â”‚ è°ƒç”¨   â”‚ â†’ â”‚ æ‰§è¡Œ   â”‚
â”‚æŠ€èƒ½æ–‡ä»¶ â”‚   â”‚Frontmatterâ”‚   â”‚åˆ°ç®¡ç†å™¨â”‚   â”‚æŠ€èƒ½   â”‚   â”‚æç¤ºè¯ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€èƒ½æ–‡ä»¶æ ¼å¼
```markdown
---
name: skill-name
description: æŠ€èƒ½æè¿°
author: ä½œè€…
version: 1.0.0
---

# æŠ€èƒ½æç¤ºè¯
ç”¨æˆ·å°†æä¾›ï¼š
- å‚æ•°1ï¼š{{param1}}
- å‚æ•°2ï¼š{{param2}}

æ‰§è¡Œé€»è¾‘...
```

#### æ‰§è¡Œæµç¨‹
```
ç”¨æˆ·è°ƒç”¨ /input skill --param="value"
  â†“
è§£ææŠ€èƒ½åç§°å’Œå‚æ•°
  â†“
ä»æŠ€èƒ½ç®¡ç†å™¨è·å–æŠ€èƒ½
  â†“
æ›¿æ¢å‚æ•°å ä½ç¬¦
  â†“
æ„å»ºå®Œæ•´æç¤ºè¯
  â†“
å‘é€ç»™ AI
  â†“
è¿”å› AI å“åº”
```

---

### 4. MCP æœåŠ¡å™¨æ¶æ„

#### MCP æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 MCP ç®¡ç†å™¨                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æœåŠ¡å™¨æ³¨å†Œ   â”‚  â”‚  è¿›ç¨‹ç®¡ç†     â”‚  â”‚  å·¥å…·è°ƒç”¨     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 MCP æœåŠ¡å™¨å®ä¾‹                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ GitHub   â”‚  â”‚Filesystemâ”‚  â”‚ SQLite   â”‚  ...        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é€šä¿¡æµç¨‹
```
AI å·¥å…·è°ƒç”¨è¯·æ±‚
  â†“
MCP ç®¡ç†å™¨æ¥æ”¶
  â†“
è·¯ç”±åˆ°å¯¹åº”æœåŠ¡å™¨
  â†“
é€šè¿‡ STDIO/HTTP è°ƒç”¨ MCP æœåŠ¡å™¨
  â†“
MCP æœåŠ¡å™¨æ‰§è¡Œå·¥å…·
  â†“
è¿”å›ç»“æœç»™ AI
  â†“
AI åŸºäºç»“æœç”Ÿæˆå›å¤
```

---

### 5. AI ä»£ç†ç³»ç»Ÿæ¶æ„

#### ä»£ç†ç¼–æ’æ¨¡å¼

##### å¹¶è¡Œæ¨¡å¼
```
ç”¨æˆ·è¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â”‚         â”‚       â”‚
ä»£ç†1   ä»£ç†2    ä»£ç†3  ä»£ç†N
â”‚       â”‚         â”‚       â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æ±‡æ€»ç»“æœ
```

##### é¡ºåºæ¨¡å¼
```
ç”¨æˆ·è¯·æ±‚ â†’ ä»£ç†1 â†’ ä»£ç†2 â†’ ä»£ç†3 â†’ æœ€ç»ˆç»“æœ
```

##### åŠ¨æ€æ¨¡å¼
```
ç”¨æˆ·è¯·æ±‚ â†’ è·¯ç”±å™¨ â†’ é€‰æ‹©æœ€é€‚åˆçš„ä»£ç† â†’ æ‰§è¡Œ â†’ è¿”å›ç»“æœ
```

#### ä»£ç†å®šä¹‰
```typescript
interface Agent {
  id: string;
  name: string;
  description: string;
  systemPrompt: string;
  tools?: Tool[];
  orchestration: 'parallel' | 'sequential' | 'dynamic';
}

// ç¤ºä¾‹ï¼šä»£ç å®¡æŸ¥å›¢é˜Ÿ
const codeReviewTeam: Agent[] = [
  {
    id: 'style-reviewer',
    name: 'ä»£ç é£æ ¼å®¡æŸ¥å‘˜',
    systemPrompt: 'ä½ è´Ÿè´£æ£€æŸ¥ä»£ç é£æ ¼...'
  },
  {
    id: 'security-reviewer',
    name: 'å®‰å…¨å®¡æŸ¥å‘˜',
    systemPrompt: 'ä½ è´Ÿè´£æ£€æŸ¥å®‰å…¨é—®é¢˜...'
  },
  {
    id: 'performance-reviewer',
    name: 'æ€§èƒ½å®¡æŸ¥å‘˜',
    systemPrompt: 'ä½ è´Ÿè´£æ£€æŸ¥æ€§èƒ½é—®é¢˜...'
  }
];
```

---

## æ•°æ®æµè®¾è®¡

### 1. å¯¹è¯æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥æ¶ˆæ¯                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¸²æŸ“è¿›ç¨‹ï¼šReact ç»„ä»¶                                      â”‚
â”‚  - æ•è·ç”¨æˆ·è¾“å…¥                                          â”‚
â”‚  - è°ƒç”¨ Zustand Store                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IPC é€šä¿¡ï¼šcontextBridge                                   â”‚
â”‚  - window.api.message.send(sessionId, content)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»è¿›ç¨‹ï¼šIPC Handler                                       â”‚
â”‚  - ipcMain.handle('message:send', handler)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸šåŠ¡å±‚ï¼šMessageHandler                                    â”‚
â”‚  - æ„å»ºæ¶ˆæ¯ä¸Šä¸‹æ–‡                                         â”‚
â”‚  - è°ƒç”¨ API ä»£ç†                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å±‚ï¼šApiProxy                                          â”‚
â”‚  - é€‰æ‹© AI æä¾›å•†                                         â”‚
â”‚  - å‘èµ· API è¯·æ±‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤–éƒ¨ï¼šAI API                                              â”‚
â”‚  - æµå¼è¿”å›å“åº”                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»è¿›ç¨‹ï¼šå¤„ç†æµå¼å“åº”                                       â”‚
â”‚  - é€å—å‘é€åˆ°æ¸²æŸ“è¿›ç¨‹                                     â”‚
â”‚  - mainWindow.webContents.send('message:chunk', chunk)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¸²æŸ“è¿›ç¨‹ï¼šæ¥æ”¶å¹¶æ˜¾ç¤º                                       â”‚
â”‚  - æ›´æ–° UI                                               â”‚
â”‚  - ä¿å­˜åˆ°æ•°æ®åº“                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. è®°å¿†æ•°æ®æµ

#### å­˜å‚¨æµç¨‹
```
ç”¨æˆ·ä¿å­˜è®°å¿†
    â†“
æ¸²æŸ“è¿›ç¨‹ï¼šwindow.api.memory.store(title, text, label)
    â†“
ä¸»è¿›ç¨‹ï¼šIPC Handler
    â†“
è®°å¿†æœåŠ¡ï¼šMemoryService
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               â”‚                â”‚
Memvid å­˜å‚¨     FileSystem å¤‡ä»½    SQLite ç´¢å¼•
(å‘é‡æ•°æ®åº“)    (æ–‡ä»¶ç³»ç»Ÿ)        (å…ƒæ•°æ®)
â”‚               â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¿”å›æˆåŠŸ
```

#### æ£€ç´¢æµç¨‹
```
ç”¨æˆ·æœç´¢è®°å¿†
    â†“
æ¸²æŸ“è¿›ç¨‹ï¼šwindow.api.memory.search(query, k)
    â†“
ä¸»è¿›ç¨‹ï¼šIPC Handler
    â†“
è®°å¿†æœåŠ¡ï¼šMemoryService.search()
    â†“
Memvid è¯­ä¹‰æœç´¢ï¼ˆå‘é‡ç›¸ä¼¼åº¦ï¼‰
    â†“
è¿”å› Top-K ç»“æœ
    â†“
æ¸²æŸ“è¿›ç¨‹ï¼šæ˜¾ç¤ºç»“æœ
```

---

### 3. æŠ€èƒ½è°ƒç”¨æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ï¼š/input skill-name --param="value"
    â†“
æ¸²æŸ“è¿›ç¨‹ï¼šè§£æå‘½ä»¤
    â†“
æ¸²æŸ“è¿›ç¨‹ï¼šwindow.api.skill.execute(name, params)
    â†“
ä¸»è¿›ç¨‹ï¼šIPC Handler
    â†“
æŠ€èƒ½æœåŠ¡ï¼šSkillsStore
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åŠ è½½æŠ€èƒ½æ–‡ä»¶                â”‚
â”‚ 2. è§£æ Frontmatter            â”‚
â”‚ 3. æ›¿æ¢å‚æ•°å ä½ç¬¦              â”‚
â”‚ 4. æ„å»ºå®Œæ•´æç¤ºè¯              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¿”å›æç¤ºè¯
    â†“
æ¸²æŸ“è¿›ç¨‹ï¼šå°†æç¤ºè¯å‘é€ç»™ AI
    â†“
AI æ‰§è¡ŒæŠ€èƒ½é€»è¾‘
    â†“
è¿”å›ç»“æœ
```

---

## çŠ¶æ€ç®¡ç†æ¶æ„

### Zustand Store è®¾è®¡

#### å…¨å±€ Store ç»“æ„
```typescript
// src/ui/store/index.ts
interface AppState {
  // ä¼šè¯çŠ¶æ€
  sessions: Session[];
  currentSessionId: string | null;

  // æ¶ˆæ¯çŠ¶æ€
  messages: Message[];

  // è®¾ç½®çŠ¶æ€
  apiConfigs: ApiConfig[];
  activeConfigId: string | null;

  // è®°å¿†çŠ¶æ€
  memories: Memory[];

  // MCP çŠ¶æ€
  mcpServers: McpServer[];

  // æŠ€èƒ½çŠ¶æ€
  skills: Skill[];
}

// æ‹†åˆ†ä¸ºå¤šä¸ª Store
const useSessionStore = create<SessionState>((set) => ({...}));
const useMessageStore = create<MessageState>((set) => ({...}));
const useSettingsStore = create<SettingsState>((set) => ({...}));
```

#### çŠ¶æ€æ›´æ–°æµç¨‹
```
ç”¨æˆ·æ“ä½œ
    â†“
ç»„ä»¶è°ƒç”¨ Store Action
    â†“
Zustand æ›´æ–°çŠ¶æ€
    â†“
è§¦å‘ç»„ä»¶é‡æ¸²æŸ“
    â†“
UI æ›´æ–°
```

#### æŒä¹…åŒ–ç­–ç•¥
```typescript
// è‡ªåŠ¨åŒæ­¥åˆ°ä¸»è¿›ç¨‹
useSessionStore.subscribe(
  (state) => state.sessions,
  (sessions) => {
    window.api.session.sync(sessions);
  },
  { equalityFn: shallow }
);
```

---

## é€šä¿¡æ¶æ„

### IPC é€šä¿¡è®¾è®¡

#### é€šä¿¡æ¨¡å¼
```
æ¸²æŸ“è¿›ç¨‹                    ä¸»è¿›ç¨‹
    â”‚                        â”‚
    â”‚ â”€â”€ request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
    â”‚ <â”€â”€â”€â”€ response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                        â”‚
    â”‚ <â”€â”€â”€â”€ event â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                        â”‚
```

#### API è®¾è®¡
```typescript
// src/electron/preload.cts
contextBridge.exposeInMainWorld('api', {
  // ä¼šè¯ç›¸å…³
  session: {
    create: (title: string) => Promise<Session>
    list: () => Promise<Session[]>
    delete: (id: string) => Promise<void>
  },

  // æ¶ˆæ¯ç›¸å…³
  message: {
    send: (sessionId: string, content: string) => Promise<string>
  },

  // è®°å¿†ç›¸å…³
  memory: {
    store: (title: string, text: string, label: MemoryLabel) => Promise<void>
    search: (query: string, k?: number) => Promise<MemoryResult[]>
  }
});
```

#### å®‰å…¨è®¾è®¡
```typescript
// ç™½åå•æœºåˆ¶
contextBridge.exposeInMainWorld('api', {
  // åªæš´éœ²å®‰å…¨çš„ API
  // ä¸æš´éœ² Node.js çš„ requireã€process ç­‰
});

// ç±»å‹å®‰å…¨
interface ElectronAPI {
  session: {
    create: (title: string) => Promise<Session>;
  };
}
declare global {
  interface Window {
    api: ElectronAPI;
  }
}
```

---

## å­˜å‚¨æ¶æ„

### æ•°æ®åº“è®¾è®¡

#### SQLite è¡¨ç»“æ„

##### sessions è¡¨
```sql
CREATE TABLE sessions (
  id TEXT PRIMARY KEY,
  title TEXT NOT NULL,
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL
);

CREATE INDEX idx_sessions_created ON sessions(created_at);
```

##### messages è¡¨
```sql
CREATE TABLE messages (
  id TEXT PRIMARY KEY,
  session_id TEXT NOT NULL,
  role TEXT NOT NULL,
  content TEXT NOT NULL,
  created_at INTEGER NOT NULL,
  FOREIGN KEY (session_id) REFERENCES sessions(id) ON DELETE CASCADE
);

CREATE INDEX idx_messages_session ON messages(session_id);
CREATE INDEX idx_messages_created ON messages(created_at);
```

##### api_configs è¡¨
```sql
CREATE TABLE api_configs (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  provider TEXT NOT NULL,
  api_key TEXT NOT NULL,
  model TEXT NOT NULL,
  base_url TEXT,
  is_active INTEGER DEFAULT 0,
  created_at INTEGER NOT NULL
);
```

---

### å‘é‡æ•°æ®åº“è®¾è®¡

#### Memvid é›†åˆç»“æ„
```typescript
interface MemoryCollection {
  name: string;
  vectors: {
    id: string;
    vector: number[];  // å‘é‡è¡¨ç¤º
    metadata: {
      title: string;
      text: string;
      label: MemoryLabel;
      created_at: number;
    };
  }[];
}
```

#### å‘é‡åŒ–ç­–ç•¥
```typescript
// ä½¿ç”¨ AI æ¨¡å‹çš„åµŒå…¥å±‚
async function vectorize(text: string): Promise<number[]> {
  const response = await fetch('https://api.openai.com/v1/embeddings', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'text-embedding-3-small',
      input: text
    })
  });

  const data = await response.json();
  return data.data[0].embedding;
}
```

---

## å®‰å…¨æ¶æ„

### 1. æ•°æ®å®‰å…¨

#### API Key åŠ å¯†å­˜å‚¨
```typescript
import { safeStorage } from 'electron';

class SecureStorage {
  encryptApiKey(apiKey: string): string {
    const buffer = Buffer.from(apiKey);
    const encrypted = safeStorage.encryptString(buffer);
    return encrypted.toString('base64');
  }

  decryptApiKey(encrypted: string): string {
    const buffer = Buffer.from(encrypted, 'base64');
    const decrypted = safeStorage.decryptString(buffer);
    return decrypted.toString();
  }
}
```

#### æ•°æ®åº“åŠ å¯†
```typescript
// SQLite SQLCipher æ‰©å±•
// æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
class EncryptedDatabase {
  constructor(dbPath: string, encryptionKey: string) {
    this.db = new Database(dbPath);
    this.db.pragma(`key = '${encryptionKey}'`);
  }
}
```

---

### 2. é€šä¿¡å®‰å…¨

#### CSP ç­–ç•¥
```typescript
// src/electron/main.ts
session.defaultSession.webRequest.onHeadersReceived((details, callback) => {
  callback({
    responseHeaders: {
      ...details.responseHeaders,
      'Content-Security-Policy': [
        "default-src 'self';",
        "script-src 'self';",
        "style-src 'self' 'unsafe-inline';",
        "img-src 'self' data: https:;"
      ].join(' ')
    }
  });
});
```

---

### 3. æƒé™æ§åˆ¶

#### IPC æƒé™ä¸­é—´ä»¶
```typescript
class PermissionMiddleware {
  private permissions: Map<string, string[]> = new Map();

  setPermission(channel: string, allowedRoles: string[]) {
    this.permissions.set(channel, allowedRoles);
  }

  checkPermission(channel: string, role: string): boolean {
    const allowedRoles = this.permissions.get(channel);
    return allowedRoles?.includes(role) ?? false;
  }
}

// ä½¿ç”¨
ipcMain.handle('dangerous:operation', (event, ...args) => {
  if (!middleware.checkPermission('dangerous:operation', event.sender.role)) {
    throw new Error 'Permission denied';
  }
  // æ‰§è¡Œæ“ä½œ
});
```

---

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

#### React 19 å¹¶å‘ç‰¹æ€§
```typescript
// ä½¿ç”¨ Transitions ä¼˜åŒ–ä½ä¼˜å…ˆçº§æ›´æ–°
import { useTransition } from 'react';

function SearchComponent() {
  const [isPending, startTransition] = useTransition();
  const [results, setResults] = useState([]);

  const handleSearch = (query: string) => {
    // é«˜ä¼˜å…ˆçº§ï¼šç«‹å³æ›´æ–°è¾“å…¥æ¡†
    setInputValue(query);

    // ä½ä¼˜å…ˆçº§ï¼šå»¶è¿Ÿæ›´æ–°æœç´¢ç»“æœ
    startTransition(() => {
      setResults(search(query));
    });
  };
}
```

#### è™šæ‹Ÿæ»šåŠ¨
```typescript
// å¤§é‡æ¶ˆæ¯åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
import { useVirtualizer } from '@tanstack/react-virtual';

function MessageList({ messages }) {
  const parentRef = useRef();

  const virtualizer = useVirtualizer({
    count: messages.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 100, // ä¼°è®¡æ¯æ¡æ¶ˆæ¯é«˜åº¦
  });

  return (
    <div ref={parentRef} style={{ height: '600px', overflow: 'auto' }}>
      <div style={{ height: `${virtualizer.getTotalSize()}px` }}>
        {virtualizer.getVirtualItems().map((virtualItem) => (
          <Message
            key={virtualItem.key}
            message={messages[virtualItem.index]}
            style={{
              position: 'absolute',
              top: 0,
              left: 0,
              width: '100%',
              transform: `translateY(${virtualItem.start}px)`,
            }}
          />
        ))}
      </div>
    </div>
  );
}
```

---

### 2. æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

#### WAL æ¨¡å¼
```typescript
// æé«˜å¹¶å‘æ€§èƒ½
db.pragma('journal_mode = WAL');
db.pragma('synchronous = NORMAL');
```

#### æ‰¹é‡æ“ä½œ
```typescript
// æ‰¹é‡æ’å…¥
function addMessages(sessionId: string, messages: Message[]) {
  const insert = db.prepare('INSERT INTO messages VALUES (?, ?, ?, ?, ?)');
  const insertMany = db.transaction((msgs) => {
    for (const msg of msgs) {
      insert.run(msg.id, sessionId, msg.role, msg.content, Date.now());
    }
  });
  insertMany(messages);
}
```

---

### 3. å†…å­˜ä¼˜åŒ–

#### æµå¼å¤„ç†
```typescript
// æµå¼è¯»å–å¤§æ–‡ä»¶
async function* streamLines(filePath: string) {
  const fileStream = fs.createReadStream(filePath);
  const rl = createInterface(fileStream);

  for await (const line of rl) {
    yield line;
  }
}

// ä½¿ç”¨
for await (const line of streamLines('large-file.txt')) {
  processLine(line);
}
```

---

## æ‰©å±•æ€§è®¾è®¡

### 1. æ’ä»¶ç³»ç»Ÿ

#### æŠ€èƒ½æ’ä»¶
```typescript
interface Skill {
  name: string;
  description: string;
  author: string;
  version: string;
  prompt: string;
  parameters?: Parameter[];
}

// åŠ¨æ€åŠ è½½æŠ€èƒ½
class SkillLoader {
  async loadFromDirectory(dir: string): Promise<Skill[]> {
    const files = await fs.readdir(dir);
    const skills: Skill[] = [];

    for (const file of files) {
      if (file.endsWith('.md')) {
        const skill = await this.parseSkill(path.join(dir, file));
        skills.push(skill);
      }
    }

    return skills;
  }
}
```

#### MCP æ’ä»¶
```typescript
interface McpServerConfig {
  id: string;
  name: string;
  command: string;
  args: string[];
  env?: Record<string, string>;
}

// åŠ¨æ€å¯åŠ¨ MCP æœåŠ¡å™¨
class McpManager {
  private servers: Map<string, ChildProcess> = new Map();

  async startServer(config: McpServerConfig): Promise<void> {
    const process = spawn(config.command, config.args, {
      env: { ...process.env, ...config.env }
    });

    this.servers.set(config.id, process);
  }
}
```

---

### 2. AI æä¾›å•†æ‰©å±•

#### æä¾›å•†æ¥å£
```typescript
interface ApiProvider {
  name: string;
  stream(messages: Message[], options: RequestOptions): AsyncIterable<string>;
  validateConfig(config: ApiConfig): Promise<boolean>;
}

// æ³¨å†Œæ–°æä¾›å•†
class ApiProxy {
  registerProvider(key: string, provider: ApiProvider): void {
    this.providers.set(key, provider);
  }
}

// ä½¿ç”¨
apiProxy.registerProvider('newprovider', new NewProvider());
```

---

## æ€»ç»“

### æ¶æ„ä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ |
|-----|------|
| **åˆ†å±‚æ¸…æ™°** | èŒè´£åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤ |
| **é«˜å†…èšä½è€¦åˆ** | æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºæµ‹è¯• |
| **å¯æ‰©å±•æ€§å¼º** | æ’ä»¶ç³»ç»Ÿï¼Œæ˜“äºæ‰©å±• |
| **æ€§èƒ½ä¼˜å¼‚** | å¹¶å‘æ¸²æŸ“ï¼Œæµå¼å¤„ç† |
| **å®‰å…¨å¯é ** | åŠ å¯†å­˜å‚¨ï¼Œæƒé™æ§åˆ¶ |

### æŠ€æœ¯äº®ç‚¹

- âœ… React 19 å¹¶å‘æ¸²æŸ“
- âœ… åŒåç«¯è®°å¿†ç³»ç»Ÿï¼ˆMemvid + FileSystemï¼‰
- âœ… æµå¼ AI å“åº”
- âœ… Zustand è½»é‡çº§çŠ¶æ€ç®¡ç†
- âœ… WAL æ¨¡å¼æ•°æ®åº“
- âœ… æ’ä»¶åŒ–æ¶æ„
- âœ… MCP åè®®é›†æˆ

---

**æ–‡æ¡£ç»´æŠ¤**: Alan
**æœ€åæ›´æ–°**: 2026-01-24
**è®¸å¯è¯**: AGPL-3.0
